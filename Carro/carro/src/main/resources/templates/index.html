<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Carros - FATEC Mococa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .banner {
            background-color: #0073e6;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        .menu {
            background-color: #005bb5;
            padding: 10px;
        }
        .menu ul {
            list-style: none;
            text-align: center;
        }
        .menu ul li {
            display: inline;
            margin: 0 15px;
        }
        .menu ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
        }
        .menu ul li a:hover {
            text-decoration: underline;
        }
        .conteudo {
            padding: 20px;
            text-align: center;
        }
        .rodape {
            background-color: #222;
            color: white;
            text-align: center;
            padding: 15px;
            margin-top: 20px;
        }
        form {
            display: grid;
            gap: 10px;
            max-width: 400px;
            margin: 0 auto 20px;
        }
        input, select, button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100%;
            font-size: 16px;
        }
        button {
            background-color: #005bb5;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #004494;
        }
        table {
            width: 80%;
            margin: 0 auto;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .actions button {
            margin: 0 5px;
            padding: 5px 10px;
            font-size: 14px;
        }
        .edit-btn {
            background-color: #f39c12;
        }
        .delete-btn {
            background-color: #e74c3c;
        }
        .save-btn {
            background-color: #27ae60;
            display: none;
        }
        #mensagem {
            margin: 10px auto;
            padding: 10px;
            max-width: 400px;
            text-align: center;
            display: none;
        }
        #buscaForm {
            max-width: 400px;
            margin: 0 auto;
        }
        #buscaResult {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<!-- Banner -->
<div class="banner">Menu Banner</div>

<!-- Menu -->
<div class="menu">
    <ul>
        <li><a href="#" onclick="showSection('home')">Home</a></li>
        <li><a href="#" onclick="showSection('cadastrarCarros')">Cadastro Carro</a></li>
        <li><a href="#" onclick="showSection('buscaPlaca')">Busca por Placa</a></li>
        <li><a href="#" onclick="showSection('contato')">Contato</a></li>
    </ul>
</div>

<!-- Conteúdo -->
<div class="conteudo">
    <!-- Home -->
    <div id="home">
        <h1>Bem Vindo ao Site</h1>
        <p>Este é um exemplo de LAYOUT</p>
    </div>

    <!-- Cadastro de Carro -->
    <div id="cadastrarCarros" style="display: none;">
        <h2>Cadastro de Carro</h2>
        <form id="carroForm">
            <input type="text" id="placa" name="placa" placeholder="Placa" required>
            <select id="marca" name="marca" required>
                <option value="">Selecione a Marca</option>
                <option value="Volkswagen">Volkswagen</option>
                <option value="Fiat">Fiat</option>
                <option value="Chevrolet">Chevrolet</option>
                <option value="Toyota">Toyota</option>
                <option value="Hyundai">Hyundai</option>
                <option value="Ford">Ford</option>
                <option value="Renault">Renault</option>
                <option value="Honda">Honda</option>
                <option value="Jeep">Jeep</option>
                <option value="Nissan">Nissan</option>
            </select>
            <input type="text" id="modelo" name="modelo" placeholder="Modelo" required>
            <input type="number" id="ano" name="ano" placeholder="Ano" required>
            <input type="text" id="cor" name="cor" placeholder="Cor" required>
            <input type="number" id="kmRodados" name="kmRodados" placeholder="KM Rodados" step="0.01" required>
            <input type="number" id="valorDiaria" name="valorDiaria" placeholder="Valor Diária" step="0.01" required>
            <select id="disponivel" name="disponivel" required>
                <option value="">Disponível?</option>
                <option value="true">Sim</option>
                <option value="false">Não</option>
            </select>
            <select id="tipoId" name="tipoCarros" required>
                <option value="">Selecione o Tipo</option>
                <!-- Opções serão preenchidas dinamicamente -->
            </select>
            <button type="submit">Enviar</button>
        </form>
        <div id="mensagem"></div>
        <table id="carrosTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Placa</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Ano</th>
                <th>Cor</th>
                <th>KM Rodados</th>
                <th>Valor Diária</th>
                <th>Disponível</th>
                <th>Tipo</th>
                <th>Ações</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Busca por Placa -->
    <div id="buscaPlaca" style="display: none;">
        <h2>Busca por Placa</h2>
        <form id="buscaForm">
            <input type="text" id="placaBusca" placeholder="Digite a Placa" required>
            <button type="submit">Buscar</button>
        </form>
        <div id="mensagem"></div>
        <div id="buscaResult"></div>
    </div>

    <!-- Contato -->
    <div id="contato" style="display: none;">
        <h2>Contato</h2>
        <p>Entre em contato conosco!</p>
    </div>
</div>

<!-- Footer -->
<div class="rodape">2025 FATEC Mococa</div>

<script>
    const API_BASE = 'http://localhost:8080';
    const mensagem = document.getElementById('mensagem');
    const tipoSelect = document.getElementById('tipoId');

    // Mostrar/esconder seções
    function showSection(sectionId) {
        document.querySelectorAll('.conteudo > div').forEach(section => {
            section.style.display = section.id === sectionId ? 'block' : 'none';
        });
        mensagem.style.display = 'none'; // Reset mensagem ao mudar seção
        if (sectionId === 'cadastrarCarros') {
            loadCarros();
            loadTipos(); // Carrega tipos ao abrir a seção
        }
        if (sectionId === 'buscaPlaca') loadBuscaForm();
    }

    // Funções auxiliares
    function showMessage(text, type) {
        mensagem.textContent = text;
        mensagem.className = type;
        mensagem.style.display = 'block';
        setTimeout(() => { mensagem.style.display = 'none'; }, 5000);
    }

    async function fetchData(url, method = 'GET', body = null) {
        const options = {
            method,
            headers: { 'Content-Type': 'application/json' },
        };
        if (body) options.body = JSON.stringify(body);
        const response = await fetch(`${API_BASE}${url}`, options);
        if (!response.ok) throw new Error(`Erro: ${response.statusText}`);
        return response.json();
    }

    // Carregar Tipos de Carro
    async function loadTipos() {
        try {
            const tipos = await fetchData('/api/tipoCarros');
            tipoSelect.innerHTML = '<option value="">Selecione o Tipo</option>';
            tipos.forEach(tipo => {
                const option = `<option value="${tipo.id}">${tipo.nome}</option>`;
                tipoSelect.insertAdjacentHTML('beforeend', option);
            });
        } catch (error) {
            showMessage('❌ Erro ao carregar tipos de carro.', 'red');
        }
    }

    // Gerenciamento de Carros
    const carroForm = document.getElementById('carroForm');
    const carrosTableBody = document.querySelector('#carrosTable tbody');

    async function loadCarros() {
        try {
            const carros = await fetchData('/api/carros');
            carrosTableBody.innerHTML = '';
            carros.forEach(carro => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${carro.id}</td>
                    <td class="editable">${carro.placa}</td>
                    <td class="editable">${carro.marca}</td>
                    <td class="editable">${carro.modelo}</td>
                    <td class="editable">${carro.ano}</td>
                    <td class="editable">${carro.cor}</td>
                    <td class="editable">${carro.kmRodados}</td>
                    <td class="editable">${carro.valorDiaria}</td>
                    <td class="editable">${carro.disponivel ? 'Sim' : 'Não'}</td>
                    <td>${carro.tipoCarros ? carro.tipoCarros.nome : 'N/A'}</td>
                    <td class="actions">
                        <button class="edit-btn" onclick="editCarro(this)">Editar</button>
                        <button class="save-btn" onclick="saveCarro(this, ${carro.id})">Salvar</button>
                        <button class="delete-btn" onclick="deleteCarro(${carro.id})">Excluir</button>
                    </td>
                `;
                carrosTableBody.appendChild(row);
            });
        } catch (error) {
            showMessage('❌ Erro ao carregar carros.', 'red');
        }
    }

    carroForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const dados = {
            placa: e.target.placa.value,
            marca: e.target.marca.value,
            modelo: e.target.modelo.value,
            ano: parseInt(e.target.ano.value),
            cor: e.target.cor.value,
            kmRodados: parseFloat(e.target.kmRodados.value),
            valorDiaria: parseFloat(e.target.valorDiaria.value),
            disponivel: e.target.disponivel.value === 'true',
            tipoCarros: { id: parseInt(e.target.tipoCarros.value) } // Envia o id do tipo
        };
        try {
            await fetchData('/api/carros', 'POST', dados);
            showMessage('✅ Cadastro realizado com sucesso!', 'green');
            e.target.reset();
            loadCarros();
        } catch (error) {
            showMessage('❌ Erro ao cadastrar carro.', 'red');
            console.error(error); // Para depuração
        }
    });

    // Funções para editar e excluir
    window.editCarro = function(button) {
        const row = button.closest('tr');
        const cells = row.querySelectorAll('.editable');
        cells.forEach(cell => {
            const input = document.createElement('input');
            input.value = cell.textContent;
            cell.innerHTML = '';
            cell.appendChild(input);
        });
        button.style.display = 'none';
        row.querySelector('.save-btn').style.display = 'inline-block';
    };

    window.saveCarro = async function(button, id) {
        const row = button.closest('tr');
        const cells = row.querySelectorAll('.editable');
        const updatedCarro = {
            placa: cells[0].querySelector('input').value,
            marca: cells[1].querySelector('input').value,
            modelo: cells[2].querySelector('input').value,
            ano: parseInt(cells[3].querySelector('input').value),
            cor: cells[4].querySelector('input').value,
            kmRodados: parseFloat(cells[5].querySelector('input').value),
            valorDiaria: parseFloat(cells[6].querySelector('input').value),
            disponivel: cells[7].querySelector('input').value === 'Sim',
            tipoCarros: { id: row.cells[9].textContent } // Ajuste para id do tipo, se aplicável
        };
        try {
            await fetchData(`/api/carros/${id}`, 'PUT', updatedCarro);
            showMessage('✅ Carro atualizado com sucesso!', 'green');
            loadCarros();
        } catch (error) {
            showMessage('❌ Erro ao atualizar carro.', 'red');
        }
    };

    window.deleteCarro = async function(id) {
        if (confirm('Tem certeza que deseja excluir este carro?')) {
            try {
                await fetchData(`/api/carros/${id}`, 'DELETE');
                showMessage('✅ Carro excluído com sucesso!', 'green');
                loadCarros();
            } catch (error) {
                showMessage('❌ Erro ao excluir carro.', 'red');
            }
        }
    };

    // Busca por Placa
    const buscaForm = document.getElementById('buscaForm');
    const buscaResult = document.getElementById('buscaResult');

    function loadBuscaForm() {
        buscaResult.innerHTML = '';
    }

    buscaForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const placa = document.getElementById('placaBusca').value;
        try {
            const carro = await fetchData(`/api/carros/placa/${placa}`);
            buscaResult.innerHTML = `
                <h3>Resultado da Busca</h3>
                <p>ID: ${carro.id}</p>
                <p>Placa: ${carro.placa}</p>
                <p>Marca: ${carro.marca}</p>
                <p>Modelo: ${carro.modelo}</p>
                <p>Ano: ${carro.ano}</p>
                <p>Cor: ${carro.cor}</p>
                <p>KM Rodados: ${carro.kmRodados}</p>
                <p>Valor Diária: ${carro.valorDiaria}</p>
                <p>Disponível: ${carro.disponivel ? 'Sim' : 'Não'}</p>
                <p>Tipo: ${carro.tipoCarros ? carro.tipoCarros.nome : 'N/A'}</p>
            `;
            showMessage('✅ Carro encontrado!', 'green');
        } catch (error) {
            showMessage('❌ Carro não encontrado ou erro na busca.', 'red');
            buscaResult.innerHTML = '';
        }
    });

    // Carregar dados iniciais
    window.addEventListener('DOMContentLoaded', () => {
        showSection('home');
    });
</script>
</body>
</html>